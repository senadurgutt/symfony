<!DOCTYPE html>
<html lang="en">
<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>{% block title %} Anasayfa {% endblock %}</title>
    <meta name="keywords" content="<title>{% block keywords %} {% endblock %}</title>">
    <meta name="description" content="<title>{% block description %} {% endblock %}</title>">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <!-- style css -->
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <!-- Responsive-->
    <link rel="stylesheet" href="/css/responsive.css">
    <!-- fevicon -->
    <link rel="icon" href="/images/fevicon.png" type="image/gif"/>
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="/css/jquery.mCustomScrollbar.min.css">
    <!-- Tweaks for older IEs-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Open+Sans:400,700&display=swap&subset=latin-ext"
          rel="stylesheet">
    <!-- owl stylesheets -->
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
          media="screen">
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="{{ asset('/css/style.css') }}">

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<!-- header section start -->
<div class="header_section">
    <div class="container-fluid">
        <nav class="navbar navbar-light bg-light justify-content-between">
            <div id="mySidenav" class="sidenav">
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                <a href="{{ path('home') }}">Anasayfa</a>
                <a href="#">Beğenilenler</a>
                <a href="about.html" onmouseover="showCategories()" onmouseout="hideCategories()">Kategoriler</a>
                <div id="categoryList" style="display: none;" onmouseover="keepCategories()" onmouseout="hideCategories()">
                    <ul>
                        {% for category in categories %}
                            <li><a href="{{ path('categories', {'id': category.id}) }}">{{ category.category }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <span class="toggle_icon" onclick="openNav()"><img src="/images/toggle-icon.png"></span>
            <a class="logo" href="#"><img src="/images/logo.png"></a></a>
            <form class="form-inline ">
                <div class="login_text">
                    <ul>
                        <li><a href="app_login"><img src="/images/user-icon.png"></a></li>
                        <li><a href="#"><img src="/images/search-icon.png"></a></li>
                    </ul>
                </div>
            </form>
        </nav>
    </div>
</div>
<!-- header section end -->

{% block mainContent %} {% endblock %}
{% block footer %} {% endblock %}

<!-- copyright section end -->
<!-- Javascript files-->
<script src="/js/jquery.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/jquery-3.0.0.min.js"></script>
<script src="/js/plugin.js"></script>
<!-- sidebar -->
<script src="/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="/js/custom.js"></script>
<!-- javascript -->
<script src="/js/owl.carousel.js"></script>
<script src="https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
<script src="/https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<script>
    function openNav() {
        document.getElementById("mySidenav").style.width = "100%";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }

</script>
<script>
    function showCategories() {
        document.getElementById("categoryList").style.display = "block";
    }

    function hideCategories() {
        document.getElementById("categoryList").style.display = "none";
    }
    function keepCategories() {
        document.getElementById("categoryList").style.display = "block";
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var form = document.getElementById('comment-form');
        if (form) {
            form.addEventListener('submit', function (event) {
                event.preventDefault(); // Formun varsayılan olarak gönderilmesini engeller

                var formData = new FormData(form);

                fetch(form.action, {
                    method: form.method,
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            var commentsList = document.getElementById('comments-list');
                            var newComment = document.createElement('div');
                            newComment.classList.add('comment');
                            newComment.innerHTML = '<p><strong>' + data.comment.member.name + ' ' + data.comment.member.surname + ':</strong> ' + data.comment.comment + '</p>';
                            commentsList.appendChild(newComment);
                            form.reset();
                        } else {
                            alert('Yorum gönderiminde bir hata oluştu');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Yorum gönderiminde bir hata oluştu');
                    });
            });
        }

    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const stars = document.querySelectorAll('.star');
        const productId = document.getElementById('rating').dataset.productId;

        // Load the current rating from the server
        fetch(`/rating/current/${productId}`)
            .then(response => response.json())
            .then(data => {
                if (data.rating) {
                    stars.forEach(star => {
                        if (parseInt(star.getAttribute('data-value')) <= data.rating) {
                            star.classList.add('active');
                        }
                    });
                }
            });

        stars.forEach(star => {
            star.addEventListener('click', function () {
                const value = this.getAttribute('data-value');

                stars.forEach(s => {
                    s.classList.remove('active');
                    if (s.getAttribute('data-value') <= value) {
                        s.classList.add('active');
                    }
                });

                // Save the rating
                fetch('/rating/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                    },
                    body: JSON.stringify({ product_id: productId, rating: value })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log('Rating saved successfully');
                        } else {
                            console.error('Failed to save rating');
                        }
                    });
            });
        });
    });
</script>
</body>
</html>